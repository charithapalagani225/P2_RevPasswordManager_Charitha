<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{layout :: head('Profile Control')}"></head>

<body>
    <div class="app-wrapper">
        <div th:replace="~{layout :: sidebar}" th:with="activePage='profile'"></div>
        <div class="main-content">
            <div th:replace="~{layout :: topbar('Identity Profile')}" th:with="user=${user}"></div>
            <div class="page-body">
                <div th:replace="~{layout :: flash}"></div>

                <div style="max-width: 640px;" class="fade-in">
                    <!-- Identity Overview -->
                    <div class="card mb-6"
                        style="margin-bottom: 32px; padding: 40px; text-align: center; background: linear-gradient(to bottom, #ffffff, var(--bg-secondary));">
                        <div style="position: relative; display: inline-block; margin-bottom: 24px;">
                            <div class="user-avatar"
                                style="width: 100px; height: 100px; font-size: 40px; margin: 0; box-shadow: var(--shadow); border: 4px solid white; overflow: hidden;">
                                <img th:if="${user.profilePhotoUrl != null}" th:src="${user.profilePhotoUrl}"
                                    style="width: 100%; height: 100%; object-fit: cover;" alt="Profile Photo" />
                                <span th:unless="${user.profilePhotoUrl != null}"
                                    th:text="${#strings.substring(user.fullName ?: user.username, 0, 1)}">U</span>
                            </div>
                            <div style="position: absolute; bottom: 0; right: 0; width: 28px; height: 28px; background: var(--success); border: 3px solid white; border-radius: 50%;"
                                th:if="${user.emailVerified}"></div>
                        </div>

                        <h2 style="font-family: 'Outfit'; font-size: 24px; color: var(--text-primary); margin-bottom: 4px;"
                            th:text="${user.fullName ?: user.username}">Full Name</h2>
                        <p style="color: var(--text-muted); font-size: 15px; margin-bottom: 20px;"
                            th:text="${user.email}">Email Address</p>

                        <div style="display: flex; justify-content: center; gap: 10px;">
                            <span
                                style="font-size: 11px; font-weight: 700; color: var(--accent-dark); background: var(--accent-soft); padding: 4px 12px; border-radius: 99px; text-transform: uppercase; letter-spacing: 0.5px;">
                                @<span th:text="${user.username}">username</span>
                            </span>
                            <span th:if="${user.totpEnabled}"
                                style="font-size: 11px; font-weight: 700; color: var(--success); background: rgba(136, 166, 142, 0.1); padding: 4px 12px; border-radius: 99px; text-transform: uppercase; letter-spacing: 0.5px;">
                                Enhanced 2FA Active
                            </span>
                        </div>
                    </div>

                    <!-- Refine Details Form -->
                    <div class="card mb-6" style="margin-bottom: 32px;">
                        <h3 class="card-title" style="margin-bottom: 24px;">Refine Identity</h3>
                        <form method="post" th:action="@{/profile}" th:object="${profileDTO}"
                            enctype="multipart/form-data">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                            <div class="form-group">
                                <label class="form-label">Identity Portrait</label>
                                <div style="display: flex; gap: 16px; align-items: center;">
                                    <input type="file" class="form-control" th:field="*{profilePhoto}" accept="image/*"
                                        style="padding: 10px; border: 1px dashed var(--accent-light); background: var(--bg-primary);" />
                                </div>
                                <p style="font-size: 12px; color: var(--text-muted); margin-top: 6px;">Recommended:
                                    Square JPG/PNG, max 2MB.</p>
                                <div class="text-danger text-sm" th:if="${#fields.hasErrors('profilePhoto')}"
                                    th:errors="*{profilePhoto}"></div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div class="form-group">
                                    <label class="form-label">Full Name</label>
                                    <input type="text" class="form-control" th:field="*{fullName}"
                                        placeholder="Enter your full name" />
                                    <div class="text-danger text-sm" th:if="${#fields.hasErrors('fullName')}"
                                        th:errors="*{fullName}"></div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Communication Email</label>
                                    <input type="email" class="form-control" th:field="*{email}"
                                        placeholder="your@email.com" />
                                    <div class="text-danger text-sm" th:if="${#fields.hasErrors('email')}"
                                        th:errors="*{email}"></div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Primary Phone (Optional)</label>
                                <input type="tel" class="form-control" th:field="*{phone}"
                                    placeholder="+1 (555) 000-0000" />
                            </div>

                            <div
                                style="display: flex; gap: 12px; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">
                                <button type="submit" class="btn btn-primary" style="padding: 12px 32px;">
                                    <span>üíæ</span> <span>Confirm Refinements</span>
                                </button>
                                <a href="/dashboard" class="btn btn-secondary">Discard Changes</a>
                            </div>
                        </form>
                    </div>

                    <!-- Security Hub -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 32px;">
                        <div class="card" style="border-left: 4px solid var(--accent);">
                            <h4
                                style="font-size: 15px; font-weight: 700; color: var(--text-primary); margin-bottom: 12px;">
                                Security Hub</h4>
                            <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 20px;">Maintain the
                                integrity of your master access and recovery points.</p>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <a href="/security/change-password" class="btn btn-secondary"
                                    style="justify-content: flex-start; font-size: 13px;">
                                    <span>üîë</span> <span>Update Master Key</span>
                                </a>
                                <a href="/security/2fa" class="btn btn-secondary"
                                    style="justify-content: flex-start; font-size: 13px;">
                                    <span>üõ°Ô∏è</span> <span>Multi-Factor Settings</span>
                                </a>
                                <a href="/security/questions" class="btn btn-secondary"
                                    style="justify-content: flex-start; font-size: 13px;">
                                    <span>üß©</span> <span>Recovery Questions</span>
                                </a>
                            </div>
                        </div>

                        <!-- Danger Zone - Refined -->
                        <div class="card"
                            style="border-left: 4px solid var(--danger); background: rgba(201, 142, 142, 0.05);">
                            <h4 style="font-size: 15px; font-weight: 700; color: var(--danger); margin-bottom: 12px;">
                                Archival Space</h4>
                            <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 20px;">Permanently
                                terminate your account and wipe all encrypted vault entities.</p>
                            <div style="margin-top: auto;">
                                <a href="/profile/delete" class="btn btn-secondary"
                                    style="width: 100%; color: var(--danger); border: 1px solid var(--danger); background: white;">
                                    <span>üóëÔ∏è</span> <span>Terminate Account</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div th:replace="~{layout :: scripts}"></div>
</body>

</html>