<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{layout :: head('Password Vault')}"></head>

<body>
    <div class="app-wrapper">
        <div th:replace="~{layout :: sidebar}" th:with="activePage='vault'"></div>
        <div class="main-content">
            <div th:replace="~{layout :: topbar('The Vault')}" th:with="user=${user}"></div>
            <div class="page-body">
                <div th:replace="~{layout :: flash}"></div>

                <!-- Filter Bar - Refined -->
                <div class="card fade-in mb-6" style="padding: 24px; margin-bottom: 32px;">
                    <form method="get" th:action="@{/vault}"
                        style="display: flex; flex-wrap: wrap; gap: 16px; align-items: center;">
                        <div style="flex: 1; min-width: 280px; position: relative;">
                            <input type="text" name="search" class="form-control"
                                placeholder="Search by account, identity, or resource..." th:value="${search}"
                                style="padding-left: 44px; height: 48px; background: var(--bg-primary);" />
                            <span
                                style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); font-size: 18px; opacity: 0.5;">üîç</span>
                        </div>

                        <div style="display: flex; gap: 12px; align-items: center;">
                            <select name="sort" class="form-control"
                                style="width: 180px; height: 48px; background: var(--bg-primary);"
                                onchange="this.form.submit()">
                                <option value="name" th:selected="${sort == 'name'}">Alphabetical</option>
                                <option value="date_added" th:selected="${sort == 'date_added'}">Chronological</option>
                                <option value="date_modified" th:selected="${sort == 'date_modified'}">Recently Refined
                                </option>
                            </select>

                            <input type="hidden" name="view" th:value="${view}" />
                            <button type="submit" class="btn btn-primary"
                                style="height: 48px; padding: 0 24px;">Search</button>
                            <a th:if="${search != null and !#strings.isEmpty(search)}" href="/vault"
                                class="btn btn-secondary" style="height: 48px; padding: 0 20px;">Clear</a>
                        </div>
                    </form>

                    <!-- Category Chips - Minimalist -->
                    <div
                        style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
                        <a th:href="@{/vault(sort=${sort})}"
                            style="padding: 6px 16px; border-radius: 99px; font-size: 13px; font-weight: 600; text-decoration: none; transition: var(--transition);"
                            th:styleappend="${category == 'ALL' or category == null} ? 'background: var(--accent); color: white;' : 'background: var(--bg-secondary); color: var(--text-secondary);'"
                            th:classappend="${category == 'ALL'} ? 'active'">All Resources</a>

                        <a th:each="cat : ${categories}" th:href="@{/vault(category=${cat.name()}, sort=${sort})}"
                            style="padding: 6px 16px; border-radius: 99px; font-size: 13px; font-weight: 600; text-decoration: none; transition: var(--transition);"
                            th:styleappend="${category == cat.name()} ? 'background: var(--accent); color: white;' : 'background: var(--bg-secondary); color: var(--text-secondary);'"
                            th:text="${cat.name().replace('_',' ')}">Category</a>
                    </div>
                </div>

                <!-- View Header -->
                <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 24px;"
                    class="fade-in">
                    <div>
                        <h2 style="font-family: 'Outfit'; color: var(--accent-dark); margin-bottom: 4px;">Vault
                            Collection</h2>
                        <p style="font-size: 13px; color: var(--text-muted);"
                            th:text="'Managing ' + ${entries.size()} + ' secure items'"></p>
                    </div>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <div
                            style="background: var(--bg-secondary); padding: 4px; border-radius: var(--radius-sm); display: flex; gap: 4px;">
                            <a th:href="@{/vault(search=${search},category=${category},sort=${sort},view='list')}"
                                style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 6px; text-decoration: none;"
                                th:styleappend="${view == 'list' or view == null} ? 'background: white; box-shadow: var(--shadow-sm);' : 'opacity: 0.5;'">
                                ‚ò∞
                            </a>
                            <a th:href="@{/vault(search=${search},category=${category},sort=${sort},view='grid')}"
                                style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 6px; text-decoration: none;"
                                th:styleappend="${view == 'grid'} ? 'background: white; box-shadow: var(--shadow-sm);' : 'opacity: 0.5;'">
                                ‚äû
                            </a>
                        </div>
                        <a href="/vault/add" class="btn btn-primary">
                            <span>‚ú®</span> <span>Add New Resource</span>
                        </a>
                    </div>
                </div>

                <!-- Empty State -->
                <div th:if="${entries.empty}" style="text-align:center; padding:80px 40px; color:var(--text-muted);"
                    class="card fade-in">
                    <div style="font-size: 64px; margin-bottom: 24px; opacity: 0.3;">üóùÔ∏è</div>
                    <h3 style="color: var(--text-primary); margin-bottom: 8px;">Your vault is looking peaceful</h3>
                    <p style="margin-bottom: 32px; max-width: 400px; margin-left: auto; margin-right: auto;">Start
                        centralizing your digital identities by adding your first secure credential.</p>
                    <a href="/vault/add" class="btn btn-primary" style="padding: 14px 32px;">
                        Secure Your First Credential
                    </a>
                </div>

                <!-- GRID VIEW - Refined Card Design -->
                <div th:if="${view == 'grid' and !entries.empty}" class="vault-grid fade-in">
                    <div th:each="entry : ${entries}" style="position:relative;">
                        <div class="vault-card"
                            style="padding: 28px; height: 100%; display: flex; flex-direction: column;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                                <div class="vault-card-icon" style="margin-bottom: 0; background: var(--bg-secondary);">
                                    üõ°Ô∏è
                                </div>
                                <form th:action="@{/vault/{id}/favorite(id=${entry.id})}" method="post">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                    <input type="hidden" name="returnUrl" value="/vault?view=grid" />
                                    <button type="submit"
                                        style="background: none; border: none; cursor: pointer; font-size: 18px; padding: 4px; transition: var(--transition);"
                                        th:styleappend="${entry.favorite} ? 'color: var(--warning);' : 'color: var(--text-muted); opacity: 0.3;'">
                                        ‚òÖ
                                    </button>
                                </form>
                            </div>

                            <h4 style="font-size: 17px; font-weight: 700; color: var(--text-primary); margin-bottom: 4px;"
                                th:text="${entry.accountName}">Account</h4>
                            <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 16px; word-break: break-all;"
                                th:text="${entry.websiteUrl ?: 'No website specified'}"></p>

                            <div style="margin-top: auto;">
                                <div
                                    style="font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 12px; display: flex; align-items: center; gap: 6px;">
                                    <span style="opacity: 0.5;">üë§</span> <span
                                        th:text="${entry.accountUsername}">Username</span>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <a th:href="@{/vault/{id}(id=${entry.id})}" class="btn btn-secondary"
                                        style="flex: 1; font-size: 13px; padding: 8px;">Details</a>
                                    <a th:href="@{/vault/{id}/edit(id=${entry.id})}" class="btn btn-secondary"
                                        style="width: 44px; padding: 8px;">‚úèÔ∏è</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LIST VIEW - Refined Table Design -->
                <div th:if="${view != 'grid' and !entries.empty}" class="card fade-in"
                    style="padding: 0; overflow: hidden;">
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Resource</th>
                                    <th>Identity</th>
                                    <th>Category</th>
                                    <th>Last Refined</th>
                                    <th style="text-align: right;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="entry : ${entries}">
                                    <td>
                                        <div style="display:flex;align-items:center;gap:12px;">
                                            <div
                                                style="width: 32px; height: 32px; background: var(--bg-hover); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                                üõ°Ô∏è
                                            </div>
                                            <div style="display: flex; flex-direction: column;">
                                                <span
                                                    style="font-weight: 700; color: var(--text-primary); line-height: 1.2;"
                                                    th:text="${entry.accountName}">Account</span>
                                                <span style="font-size: 12px; color: var(--text-muted);"
                                                    th:text="${#strings.abbreviate(entry.websiteUrl, 30)}"></span>
                                            </div>
                                            <span th:if="${entry.favorite}"
                                                style="color: var(--warning); font-size: 12px;">‚òÖ</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span style="font-size: 13px; font-weight: 500; color: var(--text-secondary);"
                                            th:text="${entry.accountUsername}"></span>
                                    </td>
                                    <td>
                                        <span
                                            style="font-size: 10px; font-weight: 700; color: var(--accent-dark); background: var(--accent-soft); padding: 4px 10px; border-radius: 99px; text-transform: uppercase;"
                                            th:text="${entry.category}"></span>
                                    </td>
                                    <td style="color: var(--text-muted); font-size: 12px;" th:text="${entry.updatedAt}">
                                    </td>
                                    <td style="text-align: right;">
                                        <div style="display:flex;gap:8px;justify-content: flex-end;">
                                            <a th:href="@{/vault/{id}(id=${entry.id})}" class="btn btn-secondary btn-sm"
                                                style="padding: 6px 14px;">View</a>
                                            <a th:href="@{/vault/{id}/edit(id=${entry.id})}"
                                                class="btn btn-secondary btn-sm" style="width: 36px;">‚úèÔ∏è</a>

                                            <form th:action="@{/vault/{id}/favorite(id=${entry.id})}" method="post"
                                                style="display:inline;">
                                                <input type="hidden" th:name="${_csrf.parameterName}"
                                                    th:value="${_csrf.token}" />
                                                <input type="hidden" name="returnUrl" value="/vault" />
                                                <button type="submit" class="btn btn-secondary btn-sm"
                                                    th:styleappend="${entry.favorite} ? 'color: var(--warning);' : 'color: var(--text-muted); opacity: 0.5;'">
                                                    ‚òÖ
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div th:replace="~{layout :: scripts}"></div>
</body>

</html>